{
    "$id": "schema.json",
    "title": "QR-codes",
    "description": "QR-codes for user take action in the game",
    "type": "object",

    "properties": {
        "id": {
            "description": "Unique identifier for the code",
            "type": "string"
        },
        "codeType": {
            "description": "Type of code. Can be Story or Help",
            "type": "string",
            "default": "station",
            "enum": ["station", "help"]
        },
        "description": {
            "description": "Information of the station. Not visible for user",
            "type": "string"
        },
        "triggers": {
            "description": "Array containg trigger event objects",
            "type": "array",
            "items": { "$ref": "#/$defs/trigger"}

        }, 
        "tags": { 
            "type": "array",
            "minItems": 1
        }
    },

    "required": ["id","codeType","triggers", "tags"],

    "additionalProperties": false,

    "$defs": {
        "trigger": {
            "type": "object",
            "properties": {
                "action": {
                    "description": "Available event triggers",
                    "type": "string",
                    "enum": ["playAudio", "startTimeLimit", "goToStation", "cancelTimer"]    
                },
                "audioFilename": {
                    "description": "Filename including file name extension",
                    "type": "string"
                },

                "timerName": {"type": "string" },
                "cancelOnLeave": {"type": "boolean"},
                "timeLimit": {"type": "number"},
                "timeLimitEnd": { 
                    "type": "object",
                    "properties": {"$ref": "#/$defs/trigger"},
                    "required": ["action"]
                },

                "goToStation": {"type": "string"},
                "toStation": {"type": "string"},

                "condition": {
                    "description": "Name of condition to check",
                    "type": "string",
                    "enum":["hasTag"]
                },
                "conditionArgs": {"type":"string"}


             },
            "allOf": [
                {"if": {
                        "properties": { "action": { "const": "playAudio"}},
                        "required": ["action"]
                    },
                "then": {"required": ["audioFilename"]}},

                {"if": {
                        "properties": { "action": { "const": "startTimeLimit"}},
                        "required": ["action"]
                    },
                "then": { "required": ["timerName", "cancelOnLeave", "timeLimit", "timeLimitEnd"] }},

                {"if": {
                    "properties": { "action": { "const": "goToStation"}},
                    "required": ["action"]
                },
                "then": { 
                    "required": ["toStation"]
                    }},

                {"if": {
                        "properties": { "condition": { "const": "hasTag"}},
                        "required": ["condition"]
                    },
                "then": {"required": ["conditionArgs"]}}

            ]




        }

        

     
        

    }

}